<!doctype html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="爱生活，爱的的">
<meta property="og:url" content="https://chenjx.cn/page/2/index.html">
<meta property="og:site_name" content="爱生活，爱的的">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="爱生活，爱的的">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://chenjx.cn/page/2/"/>





  <title>爱生活，爱的的</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">爱生活，爱的的</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/me.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="https://chenjx.cn" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            网站
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://chenjx.cn/2017/02/try-windows-server/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Robin Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="爱生活，爱的的">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/try-windows-server/" itemprop="url">初尝Windows Server</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-21T12:20:02+08:00">
                2017-02-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>以前一直觉得Linux才够Server，最近给朋友搞个云主机跑网站，不熟悉Linux的，就开了个win。然后呢，还行吧，图形界面的远程控制比想象中的好，毕竟win自家的rdp，支持UDP，压缩一下画质就可以达到流畅操作。</p>
<p>这里记录一下玩windows server的点点吧。先发了，再慢慢更新。</p>
<h2 id="远程控制篇"><a href="#远程控制篇" class="headerlink" title="远程控制篇"></a>远程控制篇</h2><p>Windows Server的远程控制很简单，这里不讨论云主机提供的VNC之类的控制，指的是通过windows的Remote Desktop Protocol来控制。废话少说，以下按客户端平台分别说明。</p>
<h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p>使用的软件是windows自带的“远程桌面连接”，搜索“mstsc”、“远程桌面连接”或者“rdp”都可以找到。<br><img src="/content/images/2017/02/--.PNG" alt=""><br>“计算机”填入主机域名或ip地址。<br>为方便远程控制的同时传文件，需要开启磁盘映射。（将本地的一个磁盘映射到云主机，可以在两个主机同时操作里面的文件。）点击“显示选项”-&gt;“本地资源”-&gt;“本地设备与资源/详细信息”，勾选要映射的驱动器，确定。<br>在“体验”选项卡，可以根据自己的带宽和云主机的公网带宽选择适合的传输模式，平衡传输质量和速度。推荐取消“视觉样式”，勾选“字体平滑”。<br>如果需要记住密码，勾选“允许我保存凭据”。  </p>
<h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><p>推荐使用软件Remmina，使用简单，功能齐全，而且是开源软件。项目主页：<a href="https://www.remmina.org。" target="_blank" rel="external">https://www.remmina.org。</a><br><img src="/content/images/2017/02/----20170222154703.png" alt=""><br>基本信息只需要服务器、用户名、密码，域留空。<br>同样推荐添加共享目录以便文件传输。</p>
<h3 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h3><p>OS X，iOS，安卓都有很多类似软件，但是特别好的一个没发现。<br>其中微软出的一个叫“Microsoft Remote Desktop”，商店搜就行。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://chenjx.cn/2016/12/https-sni/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Robin Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="爱生活，爱的的">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/https-sni/" itemprop="url">HTTPS加密的疏漏——SNI扩展字段</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-20T08:41:10+08:00">
                2016-12-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="SNI是什么？"><a href="#SNI是什么？" class="headerlink" title="SNI是什么？"></a>SNI是什么？</h2><p><a class="external" href="https://zh.wikipedia.org/wiki/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%8D%E7%A7%B0%E6%8C%87%E7%A4%BA" target="_blank" rel="external">维基百科（服务器名称指示）</a></p>
<p><strong>服务器名称指示</strong>（Server Name Indication 简称 SNI）是一个扩展的TLS计算机联网协议，这允许在握手过程开始时通过客户端告诉它正在连接的服务器的主机名称。</p>
<p><strong>作用</strong>：允许在相同的IP地址和TCP端口号的服务器上使用多个证书，而不必所有网站都使用同一个证书。在概念上等同于HTTP/1.1基于域名的虚拟主机，只不过这是在HTTPS上实现的。</p>
<h2 id="SNI信息的传输是明文的？"><a href="#SNI信息的传输是明文的？" class="headerlink" title="SNI信息的传输是明文的？"></a>SNI信息的传输是明文的？</h2><p>SNI信息是在握手的过程中，确切说是在客户端发送给服务端的第一个握手包中传递的信息。<br>这时候SSL连接还未建立起来，因此SNI信息是明文传输的。</p>
<p>如下图所示，SNI信息即在第一个SSL握手包中（Client Hello）<br><img src="/content/images/2016/12/1.PNG" alt=""></p>
<p>具体的SNI信息如下，显然是明文的：<br><img src="/content/images/2016/12/2.PNG" alt=""></p>
<h2 id="明文的SNI会带来什么后果？"><a href="#明文的SNI会带来什么后果？" class="headerlink" title="明文的SNI会带来什么后果？"></a>明文的SNI会带来什么后果？</h2><p>SNI是明文的，而且是不可能被加密的，因为秘钥还没协商好呢。<br>实际会带来的后果并不涉及安全问题，仅仅只是所请求的服务器泄露出去了，连接可能受到干扰。<br>如果网络防火墙的包过滤系统检查SNI信息的话，就可以屏蔽某些域名的https访问，就像屏蔽http一样简单。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://chenjx.cn/2016/12/arukas-io/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Robin Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="爱生活，爱的的">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/arukas-io/" itemprop="url">Arukas.io——免费docker（开放注册）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-05T12:32:57+08:00">
                2016-12-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://arukas.io/" target="_blank" rel="external">Arukas</a>是一个正在开放公测的容器宿主商，目前完全免费，据称将来也会保留免费的plan。</p>
<p>免费注册，注册验证需等24小时。</p>
<p>教程就不细说了，网上一大堆。比如： <a href="http://51.ruyo.net/p/2058.html" target="_blank" rel="external">http://51.ruyo.net/p/2058.html</a></p>
<p>可以做什么？  </p>
<ol>
<li>搭建各种容器</li>
<li>VPS搭建练手（重启会恢复默认，所以只是练手）</li>
</ol>
<p>目前服务的限制比较多，共用ip、NAT端口随机分配，所以只能用来练技术。</p>
<p>秀秀自己的<br><img src="/content/images/2016/12/----20161205201440.png" alt=""></p>
<p>服务器IP和端口会不定期更新怎么办？</p>
<p>用nodejs写个小爬虫就可以解决了，登陆拿cookie，然后抓数据再格式化一下。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> superagent = <span class="built_in">require</span>(<span class="string">'superagent'</span>);</div><div class="line"></div><div class="line"><span class="built_in">require</span>(<span class="string">'http'</span>).createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</div><div class="line">    superagent.post(<span class="string">"https://app.arukas.io/api/login"</span>)</div><div class="line">    .send(&#123;<span class="attr">email</span>: <span class="string">"yourmail@gmail.com"</span>, <span class="attr">password</span>: <span class="string">"yourArukasPassword"</span>&#125;)</div><div class="line">    .end(<span class="function">(<span class="params">err, sres</span>) =&gt;</span> &#123;</div><div class="line">        <span class="keyword">var</span> cookie = sres.header[<span class="string">'set-cookie'</span>];</div><div class="line">        superagent.get(<span class="string">"https://app.arukas.io/api/containers"</span>)</div><div class="line">        .set(<span class="string">"Cookie"</span>, cookie)</div><div class="line">        .end(<span class="function">(<span class="params">err, sres</span>) =&gt;</span> &#123;</div><div class="line">            <span class="keyword">var</span> t = sres.text;</div><div class="line">            <span class="keyword">var</span> i = t.indexOf(<span class="string">'"container_port":1234'</span>);</div><div class="line">            <span class="keyword">var</span> port = t.slice(i+<span class="number">37</span>, i+<span class="number">42</span>);</div><div class="line">            <span class="keyword">var</span> ip = t.slice(i+<span class="number">57</span>, t.indexOf(<span class="string">".jp"</span>, i+<span class="number">57</span>)).replace(<span class="regexp">/-/g</span>, <span class="string">'.'</span>);</div><div class="line">            res.write(<span class="string">"ip :  "</span> + ip + <span class="string">"\n"</span>);</div><div class="line">            res.write(<span class="string">"port: "</span> + port + <span class="string">"\n"</span>);</div><div class="line">            res.write(<span class="string">"pass: 1024\n"</span>);</div><div class="line">            res.end(<span class="string">"crypto: aes-256-cfb\n"</span>);</div><div class="line">        &#125;);</div><div class="line">    &#125;);</div><div class="line">&#125;).listen(<span class="number">1080</span>);</div></pre></td></tr></table></figure></p>
<div style="display:none"><br><br>以上程序只是粗略版的，可以加上base64编码的url和二维码。<br><br>然后就如下图了<br><img src="/content/images/2016/12/----20161212024002.png" alt=""><br><br>好吧，东西在这里 –&gt; <a href="https://sharess.arukascloud.io/" target="_blank" rel="external">https://sharess.arukascloud.io/</a><br><br></div>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://chenjx.cn/2016/12/small-skills/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Robin Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="爱生活，爱的的">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/small-skills/" itemprop="url">JavaScript的奇技淫巧</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-02T13:00:31+08:00">
                2016-12-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-百度网盘自定义分享密码"><a href="#1-百度网盘自定义分享密码" class="headerlink" title="1. 百度网盘自定义分享密码"></a>1. 百度网盘自定义分享密码</h2><p><em>学习自<a href="https://laod.cn/black-technology/baidu-wangpan-tiquma.html" target="_blank" rel="external">老D</a></em> </p>
<p>百度网盘私密分享的文件不容易被取消，可是提取的时候要输入4个字符的提取码。<br>如果能自定义提取码是不是很美妙呢？ //给妹子分享文件告诉她提取码是她生日^^</p>
<p>方法在这里，按照步骤来：</p>
<h4 id="1-选中文件，点击分享。先不要点私密分享！"><a href="#1-选中文件，点击分享。先不要点私密分享！" class="headerlink" title="1. 选中文件，点击分享。先不要点私密分享！"></a>1. 选中文件，点击分享。先不要点私密分享！</h4><h4 id="2-Ctrl-Alt-I（或F12）打开浏览器的控制台，在Console页粘贴如下代码并回车。"><a href="#2-Ctrl-Alt-I（或F12）打开浏览器的控制台，在Console页粘贴如下代码并回车。" class="headerlink" title="2. Ctrl+Alt+I（或F12）打开浏览器的控制台，在Console页粘贴如下代码并回车。"></a>2. Ctrl+Alt+I（或F12）打开浏览器的控制台，在<code>Console</code>页粘贴如下代码并回车。</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">javascript:<span class="built_in">require</span>([<span class="string">"function-widget-1:share/util/service/createLinkShare.js"</span>]).prototype.makePrivatePassword=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> prompt(<span class="string">"请输入提取码"</span>,<span class="string">"1024"</span>)&#125;</div></pre></td></tr></table></figure>
<h4 id="3-点击私密分享，在弹出框中输入4个字符，中文占3个字符。"><a href="#3-点击私密分享，在弹出框中输入4个字符，中文占3个字符。" class="headerlink" title="3. 点击私密分享，在弹出框中输入4个字符，中文占3个字符。"></a>3. 点击私密分享，在弹出框中输入4个字符，中文占3个字符。</h4><p>实在不明白可以看老D的<a href="https://laod.cn/black-technology/baidu-wangpan-tiquma.html" target="_blank" rel="external">原文</a>，有动图。<br>不要问我为什么默认是1024。不要想歪。</p>
<h2 id="2-使用多行字符串"><a href="#2-使用多行字符串" class="headerlink" title="2. 使用多行字符串"></a>2. 使用多行字符串</h2><p>学习自： <a href="http://www.cnblogs.com/ziyunfei/archive/2012/10/04/2711551.html" target="_blank" rel="external">http://www.cnblogs.com/ziyunfei/archive/2012/10/04/2711551.html</a><br><figure class="highlight js"><figcaption><span>line-numbers</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">hereDoc</span>(<span class="params">f</span>) </span>&#123;　</div><div class="line">    <span class="keyword">return</span> f.toString().replace(<span class="regexp">/^[^\/]+\/\*!?\s?/</span>, <span class="string">''</span>).replace(<span class="regexp">/\*\/[^\/]+$/</span>, <span class="string">''</span>);</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> string = hereDoc(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;<span class="comment">/*</span></div><div class="line">我</div><div class="line">你</div><div class="line">他</div><div class="line">*/&#125;);</div><div class="line"><span class="built_in">console</span>.log(string);</div></pre></td></tr></table></figure></p>
<p>我的简化版<br><figure class="highlight js"><figcaption><span>line-numbers</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> multiline = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;<span class="comment">/*</span></div><div class="line">"shaungyinhao"</div><div class="line">'danyinhao'</div><div class="line">*/&#125;).toString().slice(<span class="number">16</span>, <span class="number">-3</span>);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(multiline);</div></pre></td></tr></table></figure></p>
<p>将-3改为-5则去掉最后的换行。</p>
<p>javascript函数转字符串的格式固定，这里使用硬编码没有问题。</p>
<h2 id="3-获取中文日期和时间"><a href="#3-获取中文日期和时间" class="headerlink" title="3. 获取中文日期和时间"></a>3. 获取中文日期和时间</h2><p>这不是什么难题，但是传统的方法是通过Date对象的getYear等函数得到日期时间的各部分数字，然后再拼凑起来。其实有更简便的方法，利用JavaScript的toLocaleString格式化成不同区域的标准。如果还需要进一步格式化，使用字符串替换也可以实现大多数需求。如下<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 普通格式</span></div><div class="line">(<span class="keyword">new</span> <span class="built_in">Date</span>()).toLocaleString(<span class="string">'zh-CN'</span>, &#123; <span class="attr">hour12</span> : <span class="literal">false</span> &#125;)</div><div class="line"><span class="comment">// 进一步替换</span></div><div class="line">(<span class="keyword">new</span> <span class="built_in">Date</span>()).toLocaleString(<span class="string">'zh-CN'</span>, &#123; <span class="attr">hour12</span> : <span class="literal">false</span> &#125;).replace(<span class="regexp">/[\/|-]/</span>, <span class="string">'年'</span>).replace(<span class="regexp">/[\/|-]/</span>, <span class="string">'月'</span>).replace(<span class="regexp">/ /</span>, <span class="string">'日 '</span>)</div></pre></td></tr></table></figure></p>
<p>得到结果如下：（可在不同浏览器访问本页检查兼容性）<br><a href="javascript:$('#date1').html((new Date()).toLocaleString('zh-CN', { hour12 : false }));$('#date2').html((new Date()).toLocaleString('zh-CN', { hour12 : false }).replace(/[\/|-]/, '年').replace(/[\/|-]/, '月').replace(/ /, '日 '))" target="_blank" rel="external">显示结果</a><br>普通格式：<span id="date1"></span><br>替换后：<span id="date2"></span><br></p>
<h2 id="4-生成随机字符串"><a href="#4-生成随机字符串" class="headerlink" title="4. 生成随机字符串"></a>4. 生成随机字符串</h2><ul>
<li>生成随机数用<code>Math.random()</code>就可以了。得到的是0~1的随机数。</li>
<li><p>如果需要得到一定范围内<code>[minNum, minNum+range)</code>的随机整数，用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * range) + minNum;</div></pre></td></tr></table></figure>
</li>
<li><p>如果需要得到随机字符串呢？一种非常简便的做法是</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">Math</span>.random().toString(<span class="number">36</span>).substr(<span class="number">2</span>)</div></pre></td></tr></table></figure>
</li>
</ul>
<p>得到的是数字和小写字母组成的随机字符串。其中36表示进制，支持2~36，默认10。机智的你应该很快发现，当这个数为奇数时，生成的字符串会特别长。这种方法最大的局限就是最多只能包括小写字母，不能大小写混合。</p>
<ul>
<li>手动实现，支持任意字符集。代码就很难看了，不如一行风骚。<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> chars = <span class="string">'0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz'</span>.split(<span class="string">''</span>);</div><div class="line"><span class="keyword">var</span> key = <span class="string">""</span>;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; config.length; i++) &#123;</div><div class="line">    key += chars[<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random()*chars.length)];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>这段代码是我为了生成随机的二维码的key写的，类似短网址，为了尽量缩短字符串长度，使用了62个字符。</p>
<h2 id="5-Excel列名"><a href="#5-Excel列名" class="headerlink" title="5. Excel列名"></a>5. Excel列名</h2><p>Excel表格里面，列的名字是A~Z，但又不是简单的26进制，因为Z的下一个是AA，因此A既不是0也不是1。于是写了个函数，传入列的数字编号，得到Excel风格的列名。 传入0或负数不会出错。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 1 =&gt; A, 26 =&gt; Z, 27 = AA</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">excelColName</span>(<span class="params">n</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> c = <span class="string">''</span>;</div><div class="line">    <span class="keyword">do</span> &#123;</div><div class="line">        c = <span class="built_in">String</span>.fromCharCode(--n % <span class="number">26</span> + <span class="number">65</span>) + c;</div><div class="line">    &#125; <span class="keyword">while</span>(n = <span class="built_in">Math</span>.floor(n / <span class="number">26</span>) &gt; <span class="number">0</span>);</div><div class="line">    <span class="keyword">return</span> c;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://chenjx.cn/2016/10/h5ai/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Robin Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="爱生活，爱的的">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/h5ai/" itemprop="url">h5ai 目录列表程序的搭建</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-28T12:27:18+08:00">
                2016-10-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://larsjung.de/h5ai/" target="_blank" rel="external">h5ai</a>是一个强大美观的目录列表程序。我第一次看到它的时候就喜欢上了，这不就是我想要实现的东西吗？<br><img src="/content/images/2016/10/----20161028202839.png" alt=""></p>
<p>好了，造轮子不如搬过来直接用。</p>
<p>要求PHP环境，如果没有php而系统是ubuntu16.04，可以直接<code>apt install php</code>装一个。注意h5ai只是一个列出文件和文件夹的程序，获取文件需要文件服务器。这里使用nginx，其他服务器可看官方教程。</p>
<h2 id="下载h5ai"><a href="#下载h5ai" class="headerlink" title="下载h5ai"></a>下载h5ai</h2><p>官网地址： <a href="https://larsjung.de/h5ai/" target="_blank" rel="external">https://larsjung.de/h5ai/</a> 。点击右边的下载按钮得到压缩包，解压到你的网站根目录下。文件列表如下图：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">DOC_ROOT</div><div class="line"> ├─ _h5ai</div><div class="line"> ├─ your files</div><div class="line"> └─ and folders</div></pre></td></tr></table></figure></p>
<h2 id="配置nginx"><a href="#配置nginx" class="headerlink" title="配置nginx"></a>配置nginx</h2><p>php部分需要根据php-fpm的配置来设置，这里使用的是apt安装得到的默认配置。php版本：7.0.8 。_h5ai/private这个文件夹最好保护起来。<br><figure class="highlight js"><figcaption><span>line-numbers</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">    listen       <span class="number">80</span>;</div><div class="line">    server_name  example.com；</div><div class="line"></div><div class="line">    location / &#123;</div><div class="line">        root         html;</div><div class="line">        index        index.html /_h5ai/public/index.php;</div><div class="line">    &#125;</div><div class="line">    location /_h5ai/private &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">403</span>;</div><div class="line">    &#125;</div><div class="line">    location ~ \.php$ &#123;</div><div class="line">        root           html;</div><div class="line">        fastcgi_pass   unix:<span class="regexp">/run/</span>php/php7<span class="number">.0</span>-fpm.sock;</div><div class="line">        fastcgi_index  index.php;</div><div class="line">        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</div><div class="line">        include        fastcgi_params;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="其他设置"><a href="#其他设置" class="headerlink" title="其他设置"></a>其他设置</h2><p>修改 _h5ai/private/conf/options.json 进一步设置h5ai。例如修改passhash，默认为空密码的hash。以及修改默认语言为中文。如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&quot;l10n&quot;: &#123;</div><div class="line">    &quot;enabled&quot;: true,</div><div class="line">    &quot;lang&quot;: &quot;zh-cn&quot;,</div><div class="line">    &quot;useBrowserLang&quot;: true</div><div class="line">&#125;,</div></pre></td></tr></table></figure></p>
<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p>成果 –&gt; <a href="https://download.chenjx.cn" target="_blank" rel="external">https://download.chenjx.cn</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://chenjx.cn/2016/09/make-google-mirror2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Robin Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="爱生活，爱的的">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/make-google-mirror2/" itemprop="url">使用nginx制作镜像站</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-09-12T09:59:09+08:00">
                2016-09-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>利用反向代理工具nginx可以为一些需要的网站制作镜像站，以加快其访问速度。本篇以谷歌为例，意在交流其中的互联网知识，不提供面向大众的服务。</p>
<h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><p>镜像站在数据传输层面和CDN相似，都是基于反向代理，简单说客户浏览器访问镜像站，镜像站将request转发到源站，再将源站的response发送给客户。其中，request的数据包需要根据源站的要求作出改变，至少需要将host替换为源站的host。Useragent也同样需要传给源站，以便其提供适合用户客户端的网页。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">location / &#123;</div><div class="line">    proxy_set_header  Host  <span class="string">"www.google.com.hk"</span>;</div><div class="line">    proxy_set_header  User-Agent $http_user_agent;</div><div class="line">    proxy_set_header  Connection <span class="string">""</span>;</div><div class="line">    proxy_http_version <span class="number">1.1</span>;</div><div class="line">    proxy_pass https:<span class="comment">//www.google.com.hk;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>完成以上的基础配置，就得到了一个可以访问的镜像站。</p>
<h2 id="完善（负载均衡）【已失效】"><a href="#完善（负载均衡）【已失效】" class="headerlink" title="完善（负载均衡）【已失效】"></a>完善（负载均衡）【已失效】</h2><p>16年12月份起，负载均衡似乎毫无作用。<br>~~<br>如果你的镜像站访问频率较高，这时谷歌会返回一个可能带有验证码的403页面。利用负载均衡可以有效的减少这种情况发生的频率。首先，你需要找到多个谷歌的ip地址。使用nslookup可以查找到几个ip地址，如果还不够，可以试着在同个ip段探测。使用nmap、wget即可批量探测。推荐一个扫描google ip的神器：<a href="https://github.com/yinqiwen/gscan" target="_blank" rel="external">gscan</a>。然后将得到的ip地址作为upstream。详细教程请搜索“nginx负载均衡”。注意：如果一开始就出现403页面，应该考虑更换你的服务器的ip地址。<br>~~</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">upstream google &#123;</div><div class="line">    server www.google.com.hk:<span class="number">443</span> backup;</div><div class="line">    server <span class="number">74.125</span><span class="number">.130</span><span class="number">.17</span>:<span class="number">443</span>;</div><div class="line">    server <span class="number">74.125</span><span class="number">.130</span><span class="number">.18</span>:<span class="number">443</span>;</div><div class="line">    server <span class="number">74.125</span><span class="number">.130</span><span class="number">.19</span>:<span class="number">443</span>;</div><div class="line">&#125;</div><div class="line">location / &#123;</div><div class="line">    proxy_set_header  Host  <span class="string">"www.google.com.hk"</span>;</div><div class="line">    proxy_set_header  User-Agent $http_user_agent;</div><div class="line">    proxy_set_header  Connection <span class="string">""</span>;</div><div class="line">    proxy_http_version <span class="number">1.1</span>;</div><div class="line">    proxy_pass https:<span class="comment">//google;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="进阶（CDN和HTTPS）"><a href="#进阶（CDN和HTTPS）" class="headerlink" title="进阶（CDN和HTTPS）"></a>进阶（CDN和HTTPS）</h2><p>使用https为搜索加密是极为重要的，否则你的域名很难长期使用，甚至可能因为搜索了某个关键词而被屏蔽。使用cdn则能够为你的镜像站做ip保护和加速。目前免费的cdn不少，<a href="https://www.cloudflare.com/" target="_blank" rel="external">cloudflare</a>虽然速度不是特别快，但是综合体验不错。并且其“flexible”模式的https不要求你拥有ssl证书，只要域名规范即可开启。成功开启https后，建议强制使用https。做法可以在nginx里面写个rewrite，也可以直接在cloudflare的Page Rules添加一条规则。将<code>http://example.com/*</code> 转发（建议301）到<code>https://example.com/$1</code>。</p>
<h2 id="高级"><a href="#高级" class="headerlink" title="高级"></a>高级</h2><p>谷歌镜像站已经做好了，但是搜索出来的例如维基百科却仍然无法打开。稍微修改一下返回的页面，就能将维基百科跳转到自己的维基镜像。这里推荐使用网页内容替换的方法，用到了nginx第三方模块<code>ngx_http_substitutions_filter_module</code>。安装和使用方法请看<a class="external" href="https://github.com/yaoweibin/ngx_http_substitutions_filter_module" target="_blank" rel="external">Github</a>。这里重点提一下，替换的内容必须是没有压缩的，而不压缩会消耗更多流量。两全的方法是将压缩的内容利用nginx的gunzip模块解压。参考：<a href="https://www.v2ex.com/t/234923" target="_blank" rel="external">https://www.v2ex.com/t/234923</a> 。</p>
<h2 id="流量限制的临时解决办法——Cookie"><a href="#流量限制的临时解决办法——Cookie" class="headerlink" title="流量限制的临时解决办法——Cookie"></a>流量限制的临时解决办法——Cookie</h2><p>前面说到，为了避免出现谷歌的流量限制，应该寻找多个（我用了一千多个）谷歌ip作为upstream。但是如果还是超过了限制，下面有一个小技巧可以在出现限制的时候继续访问。出现限制的时候应该是跳转到一个<code>https://ipv4.google.com/sorry/index?continue=</code>开头的网址。首先，使用<strong>和代理服务器相同ip</strong>的vpn打开这个网址，出现验证码，输入验证码，成功弹出搜索。然后记录下此时的cookie（打开浏览器控制台，输入document.cookie回车）。最后，把这个cookie配置到nginx反代的header里，类似如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">proxy_set_header  Cookie  <span class="string">"GOOGLE_ABUSE_EXEMPTION=ID=&lt;...&gt;"</span>;</div></pre></td></tr></table></figure></p>
<p>最后，别忘了在Cookie失效后更新Cookie或去掉这句话。一次流量限制持续6小时。</p>
<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>最后附上完整配置文件，稍微修改即可使用<br><figure class="highlight"><figcaption><span>line-numbers</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line">worker_processes  1;</div><div class="line">worker_rlimit_nofile 65536;</div><div class="line">error_log  logs/error.log;</div><div class="line">pid        logs/nginx.pid;</div><div class="line"></div><div class="line">events &#123;</div><div class="line">    worker_connections  1024;</div><div class="line">&#125;</div><div class="line"></div><div class="line">http &#123;</div><div class="line">    charset  utf-8;</div><div class="line">    include       mime.types;</div><div class="line">    default_type  application/octet-stream;</div><div class="line">    access_log  logs/access.log;</div><div class="line">    sendfile        on;</div><div class="line">    keepalive_timeout  65;</div><div class="line">    gzip on;</div><div class="line">    gzip_min_length 1k;</div><div class="line">    gzip_buffers    4 16k;</div><div class="line">    gzip_http_version 1.0;</div><div class="line">    gzip_comp_level 6;</div><div class="line">    gzip_types text/plain text/css text/javascript application/json application/javascript application/x-javascript application/xml;</div><div class="line">    gzip_vary on;</div><div class="line">    client_max_body_size   10m;</div><div class="line">    client_body_buffer_size   256k;</div><div class="line">    proxy_buffer_size   64k;</div><div class="line">    proxy_buffers   4 512k;</div><div class="line">    proxy_busy_buffers_size   1024k;</div><div class="line">    server &#123;</div><div class="line">        listen       443 ssl;</div><div class="line">        server_name  guso.ml;</div><div class="line">        ssl_certificate /your/dir/to/pemOrCrt;</div><div class="line">        ssl_certificate_key /your/dir/to/key;</div><div class="line">        access_log off;</div><div class="line">        error_log off;</div><div class="line"></div><div class="line">        location / &#123;</div><div class="line">            subs_filter 'https://maps.google.com' 'http://www.google.cn';</div><div class="line">            subs_filter 'https:\/\/maps.google.com' 'http:\/\/www.google.cn';</div><div class="line">            subs_filter 'translate.google.com' 'translate.google.cn';</div><div class="line">            subs_filter_types application/json;</div><div class="line"></div><div class="line">            # remove the line below when your server is in Amarica</div><div class="line">            set $args "$&#123;args&#125;&amp;gws_rd=cr";</div><div class="line">            proxy_cookie_domain google.com guso.ml;</div><div class="line">            proxy_redirect https://www.google.com https://guso.ml;</div><div class="line">            proxy_redirect http://www.google.com https://guso.ml;</div><div class="line">            proxy_set_header  Accept-Encoding "";</div><div class="line">            proxy_set_header  Host  "www.google.com";</div><div class="line">            proxy_set_header  User-Agent $http_user_agent;</div><div class="line">            proxy_set_header  Connection "";</div><div class="line">            proxy_http_version 1.1;</div><div class="line">            proxy_pass http://unix:/var/run/google.sock;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    upstream google &#123;</div><div class="line">        server 118.98.106.212:443;</div><div class="line">        server 118.98.106.217:443;</div><div class="line">        server 118.98.106.231:443;</div><div class="line">        # add more servers here</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    server &#123;</div><div class="line">        listen unix:/var/run/google.sock;</div><div class="line">        server_name www.google.com;</div><div class="line">        proxy_set_header Accept-Encoding gzip;</div><div class="line">        proxy_set_header  Host  "www.google.com";</div><div class="line">        gunzip on;</div><div class="line"></div><div class="line">        # 使用ipv4.google.com避免走ipv6导致出错</div><div class="line">        location / &#123;</div><div class="line">            proxy_pass https://ipv4.google.com;</div><div class="line">        &#125;</div><div class="line">        # 只对/search做负载均衡，兼具速度和稳定</div><div class="line">        location /search &#123;</div><div class="line">            proxy_pass  https://google;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>–更新于12月7日–</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://chenjx.cn/2016/07/ubuntu-server-xrdp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Robin Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="爱生活，爱的的">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/ubuntu-server-xrdp/" itemprop="url">Ubuntu Server 安装xrdp使用图形界面 (16.04/14.04)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-07-29T12:17:34+08:00">
                2016-07-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、安装xrdp"><a href="#一、安装xrdp" class="headerlink" title="一、安装xrdp"></a>一、安装xrdp</h2><p>Ubuntu 16.04只需安装xrdp即可。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># apt-get install xrdp</div></pre></td></tr></table></figure></p>
<p>Ubuntu 14.04还需安装vnc4server<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># apt-get install xrdp vnc4server</div></pre></td></tr></table></figure></p>
<p>此时使用客户端连接，应该能够连接成功。</p>
<p>Ubuntu 16.04出现命令行画面。</p>
<p>Ubuntu 14.04画面为空白。</p>
<h2 id="二、安装兼容的桌面环境"><a href="#二、安装兼容的桌面环境" class="headerlink" title="二、安装兼容的桌面环境"></a>二、安装兼容的桌面环境</h2><p>兼容的桌面环境有gnome-classic，xfce，mate等</p>
<p>Unity不兼容。</p>
<p>以下两种任选其一。</p>
<h3 id="1、精简小巧的xfce"><a href="#1、精简小巧的xfce" class="headerlink" title="1、精简小巧的xfce"></a>1、精简小巧的xfce</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># apt-get install xfce4</div></pre></td></tr></table></figure>
<p><img src="/content/images/2016/07/---2.JPG" alt=""><br>这是xubuntu的桌面核心部分。</p>
<h3 id="2、精美易定制的mate"><a href="#2、精美易定制的mate" class="headerlink" title="2、精美易定制的mate"></a>2、精美易定制的mate</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># apt-get install mate-core mate-desktop-environment mate-notification-daemon</div></pre></td></tr></table></figure>
<p><img src="/content/images/2016/08/--.JPG" alt=""></p>
<h2 id="三、使用客户端连接"><a href="#三、使用客户端连接" class="headerlink" title="三、使用客户端连接"></a>三、使用客户端连接</h2><p>win10可用自带的“远程桌面连接”。</p>
<p>Linux推荐使用Remmina。</p>
<h2 id="四、解决其他问题"><a href="#四、解决其他问题" class="headerlink" title="四、解决其他问题"></a>四、解决其他问题</h2><h3 id="1、中文字体缺失"><a href="#1、中文字体缺失" class="headerlink" title="1、中文字体缺失"></a>1、中文字体缺失</h3><p>Ubuntu14.04安装fonts-droid:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># apt-get install fonts-droid</div></pre></td></tr></table></figure></p>
<p>Ubuntu16.04安装fonts-noto-cjk:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># apt-get install fonts-noto-cjk</div></pre></td></tr></table></figure></p>
<h3 id="2、xfce中terminal中tab键失效"><a href="#2、xfce中terminal中tab键失效" class="headerlink" title="2、xfce中terminal中tab键失效"></a>2、xfce中terminal中tab键失效</h3><p>在菜单中找到“Window Manager”或终端执行<code>xfwm4-settings</code>打开窗口管理器，在<code>keyboard</code>标签下将<code>Switch window for same application</code>的快捷键清除。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://chenjx.cn/2016/07/vpn-1key/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Robin Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="爱生活，爱的的">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/vpn-1key/" itemprop="url">几种VPN的一键安装脚本</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-07-22T16:59:44+08:00">
                2016-07-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>搭建各种VPN的方法网络上已经有很多教程了，本文提供的是一键安装脚本，一是为了使用方便，二是稍有基础的同学直接阅读脚本便知步骤。或许这是程序员间最好的沟通方式。</p>
<h2 id="一、Shadowsocks"><a href="#一、Shadowsocks" class="headerlink" title="一、Shadowsocks"></a>一、Shadowsocks</h2><blockquote>
<p>支持Ubuntu、Debian、CentOS  </p>
</blockquote>
<p>直接安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget https://raw.githubusercontent.com/junolym/script/master/shadowsocks/sspy.sh &amp;&amp; sudo bash sspy.sh</div></pre></td></tr></table></figure></p>
<p><a class="external" href="https://github.com/junolym/script/blob/master/shadowsocks/sspy.sh" target="_blank">Github</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line"><span class="keyword">if</span> [ `id -u` -ne 0 ]; <span class="keyword">then</span></div><div class="line">    <span class="built_in">echo</span> <span class="string">"please run it as super user"</span></div><div class="line">    <span class="built_in">exit</span> 0</div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"><span class="comment"># set PKM (package manager)</span></div><div class="line"><span class="keyword">if</span> grep -Eqi <span class="string">"CentOS"</span> /etc/issue || grep -Eq <span class="string">"CentOS"</span> /etc/*-release; <span class="keyword">then</span></div><div class="line">    PKM=<span class="string">"yum"</span></div><div class="line"><span class="keyword">elif</span>  grep -Eqi <span class="string">"Ubuntu"</span> /etc/issue || grep -Eq <span class="string">"Ubuntu"</span> /etc/*-release; <span class="keyword">then</span></div><div class="line">    PKM=<span class="string">"apt-get"</span></div><div class="line"><span class="keyword">elif</span>  grep -Eqi <span class="string">"Debian"</span> /etc/issue || grep -Eq <span class="string">"Debian"</span> /etc/*-release; <span class="keyword">then</span></div><div class="line">    PKM=<span class="string">"apt-get"</span></div><div class="line"><span class="keyword">else</span></div><div class="line">    <span class="built_in">echo</span> <span class="string">"This Script must be running at the CentOS or Ubuntu or Debian!"</span></div><div class="line">    <span class="built_in">exit</span> 1</div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">"Installing pip with <span class="variable">$PKM</span> ..."</span></div><div class="line"></div><div class="line"><span class="variable">$PKM</span> update</div><div class="line"><span class="variable">$PKM</span> -y install python-pip &amp;&amp; pip install shadowsocks || &#123;</div><div class="line">    <span class="built_in">echo</span> <span class="string">"install shadowsocks failed"</span></div><div class="line">    <span class="built_in">exit</span> 1</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">read</span> -p <span class="string">"shadowsocks port (default is 8388):"</span> port</div><div class="line"><span class="built_in">read</span> -p <span class="string">"shadowsocks password (default is password):"</span> password</div><div class="line"><span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$port</span>"</span> ]; <span class="keyword">then</span></div><div class="line">    port=8388</div><div class="line"><span class="keyword">fi</span></div><div class="line"><span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$password</span>"</span> ]; <span class="keyword">then</span></div><div class="line">    password=<span class="string">"password"</span></div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line">cat &gt;/etc/shadowsocks.json &lt;&lt;END</div><div class="line">&#123;</div><div class="line">    <span class="string">"server"</span>:<span class="string">"::"</span>,</div><div class="line">    <span class="string">"server_port"</span>:<span class="variable">$port</span>,</div><div class="line">    <span class="string">"local_port"</span>:1080,</div><div class="line">    <span class="string">"password"</span>:<span class="string">"<span class="variable">$password</span>"</span>,</div><div class="line">    <span class="string">"timeout"</span>:600,</div><div class="line">    <span class="string">"method"</span>:<span class="string">"aes-256-cfb"</span></div><div class="line">&#125;</div><div class="line">END</div><div class="line"></div><div class="line">ssserver -c /etc/shadowsocks.json -d start</div><div class="line"></div><div class="line">cat &gt;&gt;/etc/rc.local &lt;&lt;END</div><div class="line">ssserver -c /etc/shadowsocks.json -d start</div><div class="line">END</div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">"install success"</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"port is <span class="variable">$port</span>, password is <span class="variable">$password</span>"</span></div><div class="line"><span class="built_in">exit</span> 0</div></pre></td></tr></table></figure>
<h2 id="二、PPTP"><a href="#二、PPTP" class="headerlink" title="二、PPTP"></a>二、PPTP</h2><blockquote>
<p>仅限ubuntu</p>
</blockquote>
<p>直接安装：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget https://raw.githubusercontent.com/junolym/script/master/VPN/pptp.sh &amp;&amp; sudo bash pptp.sh</div></pre></td></tr></table></figure></p>
<p><a class="external" href="https://github.com/junolym/script/blob/master/VPN/pptp.sh" target="_blank">Github</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line"><span class="keyword">if</span> [ `id -u` -ne 0 ]; <span class="keyword">then</span></div><div class="line">    <span class="built_in">echo</span> <span class="string">"please run it as super user"</span></div><div class="line">    <span class="built_in">exit</span> 0</div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line">apt-get -y install pptpd || &#123;</div><div class="line">    apt-get -y update</div><div class="line">    apt-get -y install pptpd</div><div class="line">&#125; || &#123;</div><div class="line">    <span class="built_in">echo</span> <span class="string">"install pptpd failed"</span></div><div class="line">    <span class="built_in">exit</span> 1</div><div class="line">&#125;</div><div class="line"></div><div class="line">cat &gt;/etc/ppp/options.pptpd &lt;&lt;END</div><div class="line">name pptpd</div><div class="line">refuse-pap</div><div class="line">refuse-chap</div><div class="line">refuse-mschap</div><div class="line">require-mschap-v2</div><div class="line">require-mppe-128</div><div class="line">ms-dns 8.8.8.8</div><div class="line">ms-dns 8.8.4.4</div><div class="line">proxyarp</div><div class="line">lock</div><div class="line">nobsdcomp</div><div class="line">novj</div><div class="line">novjccomp</div><div class="line">nologfd</div><div class="line">END</div><div class="line"></div><div class="line">cat &gt;/etc/pptpd.conf &lt;&lt;END</div><div class="line">option /etc/ppp/options.pptpd</div><div class="line">logwtmp</div><div class="line">localip 192.168.2.1</div><div class="line">remoteip 192.168.2.10-100</div><div class="line">END</div><div class="line"></div><div class="line">cat &gt;&gt; /etc/sysctl.conf &lt;&lt;END</div><div class="line">net.ipv4.ip_forward=1</div><div class="line">END</div><div class="line"></div><div class="line">sysctl -p</div><div class="line"></div><div class="line">iptables-save &gt; /etc/iptables.down.rules</div><div class="line"></div><div class="line">iptables -t nat -A POSTROUTING -s 192.168.2.0/24 -o eth0 -j MASQUERADE</div><div class="line"></div><div class="line">iptables -I FORWARD -s 192.168.2.0/24 -p tcp --syn -i ppp+ -j TCPMSS --<span class="built_in">set</span>-mss 1300</div><div class="line"></div><div class="line">iptables-save &gt; /etc/iptables.up.rules</div><div class="line"></div><div class="line">cat &gt;&gt;/etc/ppp/pptpd-options&lt;&lt;EOF</div><div class="line">pre-up iptables-restore &lt; /etc/iptables.up.rules</div><div class="line">post-down iptables-restore &lt; /etc/iptables.down.rules</div><div class="line">EOF</div><div class="line"></div><div class="line"><span class="built_in">read</span> -p <span class="string">"pptp username (default is test):"</span> username</div><div class="line"><span class="built_in">read</span> -p <span class="string">"pptp password (default is test):"</span> password</div><div class="line"><span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$username</span>"</span> ]; <span class="keyword">then</span></div><div class="line">    username=<span class="built_in">test</span></div><div class="line"><span class="keyword">fi</span></div><div class="line"><span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$password</span>"</span> ]; <span class="keyword">then</span></div><div class="line">    password=<span class="built_in">test</span></div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line">cat &gt;/etc/ppp/chap-secrets &lt;&lt;END</div><div class="line"><span class="variable">$username</span> pptpd <span class="variable">$password</span> *</div><div class="line">END</div><div class="line"></div><div class="line">service pptpd restart</div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">"install success"</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"username is <span class="variable">$username</span>, password is <span class="variable">$password</span>"</span></div><div class="line"><span class="built_in">exit</span> 0</div></pre></td></tr></table></figure>
<h2 id="三、IKEv2"><a href="#三、IKEv2" class="headerlink" title="三、IKEv2"></a>三、IKEv2</h2><p>传送 –&gt;<br><a class="external" href="https://github.com/quericy/one-key-ikev2-vpn" target="_blank" rel="external">Github</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://chenjx.cn/2016/07/vinzor-exploit/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Robin Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="爱生活，爱的的">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/vinzor-exploit/" itemprop="url">Vinzor云桌面——追求开放与自由</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-07-06T08:32:08+08:00">
                2016-07-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Vinzor云桌面（云晫虚拟课室）采用Ubuntu12.04系统。下面演示在云桌面中传输文件，提权（SU），开放网络访问等操作。另有Linux和Mac远程控制云桌面的方法。</p>
<h2 id="一、访问云桌面挂载的smb磁盘"><a href="#一、访问云桌面挂载的smb磁盘" class="headerlink" title="一、访问云桌面挂载的smb磁盘"></a>一、访问云桌面挂载的smb磁盘</h2><p>通常云桌面会自动挂载一个samba分享磁盘到本地，而开机自动挂载磁盘的命令一般保存在rc.local等开机启动脚本中，因此只要能查看这个脚本，就能够知道这个samba访问的地址、用户名、密码。</p>
<p>如下图，rc.local中第一行就透露了这些信息。另外还有路由和防火墙的设置命令。<img src="/content/images/2016/07/1.jpg" alt=""></p>
<p>在windows访问这个网络磁盘：<br>资源管理器访问<code>\\172.18.215.5\1433****</code>，注意是反斜杠，然后输入学号和密码，即上图中pass=后面的一串<img src="/content/images/2016/07/2.jpg" alt=""><br>Linux和Mac访问地址为<code>smb://172.18.215.5/1433****</code>。</p>
<h2 id="二、提权"><a href="#二、提权" class="headerlink" title="二、提权"></a>二、提权</h2><p>提权是利用Ubuntu的漏洞，由于云桌面系统内核比较老，仍存在提权漏洞。这里利用的是<a href="https://www.exploit-db.com/exploits/37292/" target="_blank" rel="external">37292</a>这个漏洞。<br>其中37292.c这个文件可以传进去，也可以手打，百来行C代码而已。<br><a class="btn btn-download" href="https://www.exploit-db.com/download/37292" target="_blank" rel="external">下载</a></p>
<p>gcc编译运行：此时已开启一个su终端。提权成功。<img src="/content/images/2016/07/3.jpg" alt=""></p>
<p class="warning">提权成功后可以先修改root密码，如无必需，不要修改默认账户的密码。如果修改后无法进入桌面，请修改<code>/etc/xrdp/xrdp.ini</code>中[xrdp1]的<code>password=ask</code>为<code>password=你的密码</code>。<br></p>

<h2 id="三、开放网络访问"><a href="#三、开放网络访问" class="headerlink" title="三、开放网络访问"></a>三、开放网络访问</h2><p>云桌面中网络访问的障碍一般是删除了默认路由和防火墙。当然，前提是云桌面所在的服务器是连上外网的。</p>
<p>以下命令可以开放防火墙<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># iptables -P INPUT ACCEPT</div><div class="line"># iptables -P OUTPUT ACCEPT</div><div class="line"># iptables -P FORWARD ACCEPT</div></pre></td></tr></table></figure></p>
<p>用route命令查看路由表，或者用ifconfig查看路由。然后设置默认路由。如果查看路由表时看到已经有默认路由，省略这一步。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># route add default gw 路由ip地址</div></pre></td></tr></table></figure></p>
<p><img src="/content/images/2016/07/7.jpg" alt=""></p>
<p>检查网络访问：<img src="/content/images/2016/07/8.jpg" alt=""></p>
<h2 id="四、ssh和sftp"><a href="#四、ssh和sftp" class="headerlink" title="四、ssh和sftp"></a>四、ssh和sftp</h2><p>云桌面访问时延迟比较大，而且要配置一个舒服的编程环境比较难，所以开启ssh和sftp访问，就像操作VPS一样舒服。需要安装<a href="http://packages.ubuntu.com/precise/amd64/openssh-server/download" target="_blank" rel="external">openssh-server</a>和<a href="http://packages.ubuntu.com/precise/amd64/openssh-client/download" target="_blank" rel="external">openssh-client</a>。可以传入安装包或者开放网络访问后apt-get。</p>
<p>鼠标悬浮在“云桌面”上可见主机地址。</p>
<p>在windows上可以用winscp和putty连接：<img src="/content/images/2016/07/9.jpg" alt=""></p>
<p>如需使用X11，除参考网上教程设置以外，还需确保<code>sshd_config</code>文件中加上了这一行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">X11UseLocalhost no</div></pre></td></tr></table></figure></p>
<p>客户端使用ssh加上-X参数连接便可以在命令行打开图形界面程序：<img src="/content/images/2016/07/----20160717014800.png" alt=""></p>
<h2 id="五、使用其他客户端连接云桌面。"><a href="#五、使用其他客户端连接云桌面。" class="headerlink" title="五、使用其他客户端连接云桌面。"></a>五、使用其他客户端连接云桌面。</h2><p>云桌面的客户端实现的功能其实是获取每个云桌面的独立ip地址并调用windows通用的远程桌面连接，传入ip地址和默认账户密码进行登录。所以可以使用各种客户端登录自己的云桌面。</p>
<p class="note">使用其他客户端连接需要知道自己云桌面的独立ip，鼠标悬浮在“云桌面”上可见主机地址。还需要云桌面内的账户名和密码（不是学号）。</p>

<h3 id="Win10自带的“远程桌面连接”"><a href="#Win10自带的“远程桌面连接”" class="headerlink" title="Win10自带的“远程桌面连接”"></a>Win10自带的“远程桌面连接”</h3><p><img src="/content/images/2016/07/---1.JPG" alt=""></p>
<h3 id="Linux客户端“Remmina”"><a href="#Linux客户端“Remmina”" class="headerlink" title="Linux客户端“Remmina”"></a>Linux客户端“Remmina”</h3><p><img src="/content/images/2016/07/----20160712233251.png" alt=""></p>
<h3 id="Mac客户端"><a href="#Mac客户端" class="headerlink" title="Mac客户端"></a>Mac客户端</h3><p><a class="external" href="https://itunes.apple.com/us/app/microsoft-remote-desktop/id715768417?mt=12" target="_blank" rel="external">Microsoft remote desktop</a></p>
<p>另还有rdesktop等许多客户端可供使用。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://chenjx.cn/2016/07/fixgrub/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Robin Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="爱生活，爱的的">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/fixgrub/" itemprop="url">Ubuntu Grub引导修复</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-07-05T13:20:28+08:00">
                2016-07-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Grub引导修复的方法有几种：LiveCD/USB修复、Grub恢复模式修复、Grub4Dos修复等。根据系统启动方式的不同（MBR or EFI），每种方法具体操作不同。本文记录下个人修复的经验。</p>
<h2 id="MBR模式——进入Live系统重安装Grub"><a href="#MBR模式——进入Live系统重安装Grub" class="headerlink" title="MBR模式——进入Live系统重安装Grub"></a>MBR模式——进入Live系统重安装Grub</h2><h3 id="1、找到原系统所在分区"><a href="#1、找到原系统所在分区" class="headerlink" title="1、找到原系统所在分区"></a>1、找到原系统所在分区</h3><p><code>fdisk -l</code>命令列出分区，找到原系统所在分区，下面例子中的/dev/sda7。如果安装系统时单独分出了/boot，也需要找到该分区。</p>
<h3 id="2、执行以下命令"><a href="#2、执行以下命令" class="headerlink" title="2、执行以下命令"></a>2、执行以下命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># mount /dev/sda7 /media/mnt</div><div class="line"># mount /dev/sda8 /media/mnt/boot （如果boot单独分区）</div><div class="line"># chroot /media/mnt</div><div class="line"># grub-install -root-directory=/mnt /dev/sda</div></pre></td></tr></table></figure>
<h2 id="EFI模式——进入Live系统替换EFI文件"><a href="#EFI模式——进入Live系统替换EFI文件" class="headerlink" title="EFI模式——进入Live系统替换EFI文件"></a>EFI模式——进入Live系统替换EFI文件</h2><p><strong>注：本方法要求系统可以启动进入windows，适用于无法手动添加EFI启动项时。</strong></p>
<h3 id="1、挂载EFI分区"><a href="#1、挂载EFI分区" class="headerlink" title="1、挂载EFI分区"></a>1、挂载EFI分区</h3><p>命令<code>fdisk -l</code>列出分区，找到EFI分区号（下面例子中的sda2）并挂载：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># mount /dev/sda2 /media/mnt</div></pre></td></tr></table></figure></p>
<h3 id="2、备份windows的efi文件"><a href="#2、备份windows的efi文件" class="headerlink" title="2、备份windows的efi文件"></a>2、备份windows的efi文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># cd /media/mnt/EFI/Microsoft/Boot/</div><div class="line"># cp bootmgfw.efi win.efi</div></pre></td></tr></table></figure>
<h3 id="3、替换ubuntu的efi文件"><a href="#3、替换ubuntu的efi文件" class="headerlink" title="3、替换ubuntu的efi文件"></a>3、替换ubuntu的efi文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># cd /media/mnt/EFI/</div><div class="line"># cp ubuntu/grubx64.efi /Microsoft/Boot/bootmgfw.efi</div></pre></td></tr></table></figure>
<p><strong>此时重启，应该可以看到熟悉的Grub画面了。</strong></p>
<h3 id="4、找回windows启动项"><a href="#4、找回windows启动项" class="headerlink" title="4、找回windows启动项"></a>4、找回windows启动项</h3><p>如果刚刚的Grub启动选择菜单中已经有windows启动项，但是无法启动，修改/boot/grub/grub.cfg，将bootmgfw.efi替换为win.efi。</p>
<p>如果Grub启动菜单中没有windows项，可以尝试<code>update-grub</code>命令。</p>
<hr>
<p><em>等待补充</em></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Robin Chen" />
          <p class="site-author-name" itemprop="name">Robin Chen</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">39</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Robin Chen</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

  

</body>
</html>
